<!DOCTYPE html>
<html lang="en">
<head>
    <title>유한대학교 학생상담센터</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="/js/jquery-latest.min.js"></script>
	<script src="/lib/tinymce_5.6.1/tinymce/js/tinymce/tinymce.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@coreui/coreui/dist/css/coreui.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://unpkg.com/@coreui/icons@2.0.0-beta.3/css/all.min.css">
	<style>
		.fixed_save_btn{
			position: fixed;
			top: 20%;
			left: 80%;
			z-index:999;
		}
		.pr_10{
			padding-right:10px;
		}
		.pr_30{
			padding-right:30px;
		}
		.tox-tinymce-aux{
			width:0px !important;
		}
		.sk-chase{
			width: 100px;
			height: 100px;
			position: relative;
			animation: sk-chase 2.5s infinite linear both;
		}
		.sk-chase-dot{
			width: 100%;
			height: 100%;
			position: absolute;
			left: 0;
			top: 0; 
			animation: sk-chase-dot 2.0s infinite ease-in-out both; 
		}
		.sk-chase-dot:before{
			content: '';
			display: block;
			width: 25%;
			height: 25%;
			background-color: #0275d8;
			border-radius: 100%;
			animation: sk-chase-dot-before 2.0s infinite ease-in-out both; 
		}
		.sk-chase-dot:nth-child(1){ animation-delay: -1.1s; }
		.sk-chase-dot:nth-child(2){ animation-delay: -1.0s; }
		.sk-chase-dot:nth-child(3){ animation-delay: -0.9s; }
		.sk-chase-dot:nth-child(4){ animation-delay: -0.8s; }
		.sk-chase-dot:nth-child(5){ animation-delay: -0.7s; }
		.sk-chase-dot:nth-child(6){ animation-delay: -0.6s; }
		.sk-chase-dot:nth-child(1):before{ animation-delay: -1.1s; }
		.sk-chase-dot:nth-child(2):before{ animation-delay: -1.0s; }
		.sk-chase-dot:nth-child(3):before{ animation-delay: -0.9s; }
		.sk-chase-dot:nth-child(4):before{ animation-delay: -0.8s; }
		.sk-chase-dot:nth-child(5):before{ animation-delay: -0.7s; }
		.sk-chase-dot:nth-child(6):before{ animation-delay: -0.6s; }
		@keyframes sk-chase{
			100%{ transform: rotate(360deg); } 
		}
		@keyframes sk-chase-dot{
			80%, 100%{ transform: rotate(360deg); } 
		}
		@keyframes sk-chase-dot-before{
			50%{
				transform: scale(0.4);
			}
			100%, 0%{
				transform: scale(1.0);
			} 
		}
	</style>
</head>
<body class="c-app">
	<div class="sk-chase" style="position: absolute; margin-left: 50%; margin-top: 300px;">
		<div class="sk-chase-dot"></div>
		<div class="sk-chase-dot"></div>
		<div class="sk-chase-dot"></div>
		<div class="sk-chase-dot"></div>
		<div class="sk-chase-dot"></div>
		<div class="sk-chase-dot"></div>
	</div>
    <div class="c-sidebar c-sidebar-dark c-sidebar-fixed c-sidebar-lg-show" id="sidebar">
        <%- include ('adminNav'); -%>
        <button class="c-sidebar-minimizer c-class-toggler" type="button" data-target="_parent" data-class="c-sidebar-minimized"></button>
    </div>
    <div class="c-wrapper c-fixed-components">
        <header class="c-header c-header-light c-header-fixed c-header-with-subheader">
            <button class="c-header-toggler c-class-toggler d-lg-none mfe-auto" type="button" data-target="#sidebar"
                data-class="c-sidebar-show">
                <i class="cil-hamburger-menu"></i>
            </button><a class="c-header-brand d-lg-none" href="#">
                <i class="cil-hamburger-menu"></i></a>
            <button class="c-header-toggler c-class-toggler mfs-3 d-md-down-none" type="button" data-target="#sidebar"
                data-class="c-sidebar-lg-show" responsive="true">
                <i class="cil-hamburger-menu"></i>
            </button>
            <ul class="c-header-nav ml-auto mr-4">
            <%- include ('adminAccount'); -%>
            </ul>
            <div class="c-subheader px-3">
                <ol class="breadcrumb border-0 m-0">
                    <li class="breadcrumb-item">예약</li>
                    <li class="breadcrumb-item">양식 항목</li>
                    <li class="breadcrumb-item active"><%=type[1]%></li>
                </ol>
            </div>
        </header>
        <div class="c-body">
            <main class="c-main">
                <div class="container-fluid">
                    <div class="fade-in">
                        <div class="card" id="tinyCard" style="display: none;">
                            <div class="card-body">
								<textarea class="tinymce" id="textEditor"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <footer class="c-footer">
                <div><a href="https://coreui.io">CoreUI</a> &copy; 2020 creativeLabs.</div>
                <div class="ml-auto">Powered by&nbsp;<a href="https://coreui.io/">CoreUI</a></div>
            </footer>
        </div>
    </div>
	<script src="/lib/coreui.bundle.min.js"></script>
	<script>
		function image_handler(blobInfo, success, failure, progress) {
			var image_size = blobInfo.blob().size;
			var max_size = 5 * 1024 * 1024; // 5MB
			
			if(image_size  > max_size) {
				failure('5MB 미만의 이미지만 삽입이 가능합니다.', { remove : true });
				return;      
			}
			else {
				var xhr, formData;

				xhr = new XMLHttpRequest();
				xhr.withCredentials = false;
				xhr.open('POST', '/admin/uploadFile');

				xhr.onload = function() {
					var json;
					
					if (xhr.status != 200) {
						failure('HTTP Error: ' + xhr.status);
						return;
					}
					
					json = JSON.parse(xhr.responseText);
					
					if (!json || typeof json.location != 'string') {
						failure('Invalid JSON: ' + xhr.responseText);
						return;
					}
					
					success(json.location);
				};

				formData = new FormData();
				formData.append('file', blobInfo.blob(), blobInfo.filename());

				xhr.send(formData);
			}
		};
		
		tinymce.init({
			selector: "textarea.tinymce",
			
			language:"ko_KR",

			height: 800,

			statubar: true,
			
			plugins: [
				"advlist autolink link lists charmap print preview hr anchor pagebreak",
				"searchreplace visualblocks visualchars fullscreen insertdatetime nonbreaking",
				"table contextmenu directionality emoticons paste textcolor image imagetools save"
			], // advlist

			/* toolbar */
			toolbar: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | print preview  fullpage | forecolor backcolor emoticons  image save" ,
			// 뒤로 가기 앞으로 가기 | 텍스트 변경 select | 굵게 기울게 | 왼쪽 정렬 가운데 정렬 오른쪽 정렬 양쪽 정렬 | 기호 리스트 숫자 리스트 내어쓰기 들여쓰기
			// 링크 | 출력 미리보기 풀페이지 | 
			
			images_upload_handler: image_handler,
			
			/* style */
			style_formats: [
				{title: "Headers", items: [
					{title: "Header 1", format: "h1"},
					{title: "Header 2", format: "h2"},
					{title: "Header 3", format: "h3"},
					{title: "Header 4", format: "h4"},
					{title: "Header 5", format: "h5"},
					{title: "Header 6", format: "h6"}
				]},
				{title: "Inline", items: [
					{title: "Bold", icon: "bold", format: "bold"},
					{title: "Italic", icon: "italic", format: "italic"},
					{title: "Underline", icon: "underline", format: "underline"},
					{title: "Strikethrough", icon: "strikethrough", format: "strikethrough"},
					{title: "Superscript", icon: "superscript", format: "superscript"},
					{title: "Subscript", icon: "subscript", format: "subscript"},
				]},
				{title: "Blocks", items: [
					{title: "Paragraph", format: "p"},
					{title: "Blockquote", format: "blockquote"},
					{title: "Div", format: "div"},
					{title: "Pre", format: "pre"}
				]},
				{title: "Alignment", items: [
					{title: "Left", icon: "alignleft", format: "alignleft"},
					{title: "Center", icon: "aligncenter", format: "aligncenter"},
					{title: "Right", icon: "alignright", format: "alignright"},
					{title: "Justify", icon: "alignjustify", format: "alignjustify"}
				]}
			],
			
			init_instance_callback: function(editor) {
    			editor.setContent(`<%-result%>`);
				$('.sk-chase').remove();
				$('#tinyCard').show();
  			},
			
			save_onsavecallback: function() {
				let content=tinymce.get("textEditor").getContent();
				$.ajax({
					type: "POST",
					dataType: "json",
					url: '../saveBoard/<%=type[0]%>',
					async: true,
					data: { "sendAjax" : content },
					success: function(data) {
						if (data.state === 'ok') {
							$('.c-main').prepend(`
								<div class="alert alert-success alert-dismissible fade show successAlert" role="alert">
									<strong>저장 완료!</strong> 게시물이 정상적으로 저장되었습니다.
									<button type="button" class="close" data-dismiss="alert" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
							`);

							$(window).scrollTop(0);

							$('.successAlert').eq(0).fadeOut(3000);
						}
						else {
							$('.c-main').prepend(`
								<div class="alert alert-danger alert-dismissible fade show failAlert" role="alert">
									<strong>저장 실패!</strong> 다시 한번 확인해 주세요.
									<button type="button" class="close" data-dismiss="alert" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
							`);

							$(window).scrollTop(0);

							$('.failAlert').eq(0).fadeOut(3000);
						}
					}
				});
			}
		});
	</script>
</body>
</html>
