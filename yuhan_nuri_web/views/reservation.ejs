<!DOCTYPE html>
<html>
	<head>
		<title>유한누리 예약 페이지</title>
		<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
		  integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
		  crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"
			integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
			crossorigin="anonymous">
		</script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
			integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
			crossorigin="anonymous">
		</script>
		<style>
			body {
				width:100%;
			}
			.fade-text {
				font-size:150%;
				color:#494949;
  				animation: fadein-text 3s;
  				-moz-animation: fadein-text 3s; /* Firefox */
  				-webkit-animation: fadein-text 3s; /* Safari and Chrome */
  				-o-animation: fadein-text 3s; /* Opera */
			}
			.fade-app {
				font-size:80%;
				color:#444444;
  				animation: fadein-app 3s;
  				-moz-animation: fadein-app 3s; /* Firefox */
  				-webkit-animation: fadein-app 3s; /* Safari and Chrome */
  				-o-animation: fadein-app 3s; /* Opera */
			}
			@keyframes fadein-text {
    			from {
        			opacity: 0;
		  			transform: translateY(50%);
    			}
    			to {
        			opacity: 1;
					transform: translateY(0);
				}
			}
			@keyframes fadein-app {
    			from {
        			opacity: 0;
    			}
    			to {
        			opacity: 1;
				}
			}
			.btnClass{
				display:none;
			}
			.btnClass + label{ 
				display: inline-block; 
				cursor: pointer; 
				line-height: 23px; 
				padding-left: 26px; 
				background: url('/res/imgs/check-off.png') left/20px no-repeat;
			}
			.btnClass:checked + label {
				background-image: url('/res/imgs/check-on.png');
				color:#0275d8;
			}
			.btnMentalClass{
				display: inline-block;
				cursor: pointer;
				line-height: 22px;
				padding-left: 18px;
				border:none;
				background: url('/res/imgs/btnMentalDes-normal.png')  left/20px no-repeat;
				outline:none;
			}
			.btnMentalClass:hover{
				display: inline-block;
				cursor: pointer;
				line-height: 22px;
				padding-left: 18px;
				border:none;
				background: url('/res/imgs/btnMentalDes-overlay.png')  left/20px no-repeat;
			}
			.form-nametag {
				font-size : 18px;
			}
			.form-question {
				margin-top:30px;
				margin-bottom:10px;
			}
			.form-card {
				margin-bottom:20px;
			}
			.col-title{
				text-align: left;
				font-weight: bold;
				margin-top: 0;
			}
			.col-agreetext{
				font-weight:normal;
				color:#60b6aa;
				font-size:80%;
			}
			.col-text{
				width: 100%;
				margin-bottom: 70px;
			}
			.form-text{
				padding-bottom:30%;
			}
			.formType {
				margin-left: 5px;
				margin-right: 5px;
				border:1px solid #ddd;
				border-left:0!important;
				border-right:0!important;
			}
			.btnType {
				cursor: pointer;
				padding: 2vh 0;
				text-align:center;
				font-size: 1em;
				background-color: white;
			}
			.formDate {
				margin-left: 5px;
				margin-right: 5px;
				border:1px solid #ddd;
				border-left:0!important;
				border-right:0!important;
			}
			.btnDate {
				cursor: pointer;
				padding: 2vh 0;
				text-align:center;
				font-size: 1.3em;
				background-color: white;
			}
			.formTime {
				margin-left: 5px;
				margin-right: 5px;
				border:1px solid #ddd;
				border-left:0!important;
				border-right:0!important;
			}
			.btnTime {
				cursor: pointer;
				padding: 2vh 0;
				text-align:center;
				font-size: 1.3em;
				background-color: white;
			}
			.selfchek-title {
                font-size:150%;
				color:#494949;
                margin-bottom: 5%;
                margin-top: 3%;
            }
            .selfcheck-subject {
                font-size:130%;
				color:#494949;
                font-weight: bold;
            }
            #radios{
                position:relative;
                width:70%;
                margin:0 auto;
            }
            .selfcheck-radio{
                position:absolute;
                right:1000%;
            }
            .radio-border{
                float:left;
                width:15%; padding-bottom:15%;
                margin:0 2.5%;
                background:#0275d8;
                border-radius:50%;
                cursor:pointer;
            }
            #slider{
                position:absolute;
                left:40%; top:0;
                width:10%; padding-bottom:10%;
                margin:2.5% 0 0 5%;
                background:#fff;
                transition:transform 1s;
                border-radius:50%;
                animation-timing-function: ease-in-out;
                animation-duration:.3s;
                animation-fill-mode: forwards;
                transition: 0.2s left .05s ease-in-out;
            }
            .radio1:checked  ~ #slider{ animation-name: radio1; left:0; }
			.radio2:checked  ~ #slider{ animation-name: radio2; left:20%; }
			.radio3:checked  ~ #slider{ animation-name: radio3; left:40%; }
			.radio4:checked  ~ #slider{ animation-name: radio4; left:60%; }
			.radio5:checked  ~ #slider{ animation-name: radio5; left:80%; }
		</style>
	</head>
	
	<body>
		<div class="container-fluid">
			<div class="row" style="height:50px; margin-bottom:20px;">
				<div class="col mt-2 align-self-center">
					<label style="font-size:180%;">예약</label>
				</div>
			</div>
			
			<div class="tab-content">
                
				<div class="tab-pane fade show active" id="applicationTab">
					<div class="row" style="height: 60px;">
						<div class="fade-text col align-self-center text-center" style="color:#1a1a1a;">
							<label>무엇을 원하시나요?</label>
						</div>
					</div>
					
					<div class="row align-self-center" style="height: 40px; margin-bottom:40px;">
						<div class="fade-app col text-center align-self-center">
							<input type="radio" id="appMental" name="btnApp" class="btnClass">
							<label for="appMental" class="mr-4" style="font-size:130%;">심리검사</label>

							<input type="radio" id="appConsult" name="btnApp" class="btnClass">
							<label for="appConsult" style="font-size:130%;">상담예약</label>
						</div>
					</div>
					
					<div style="border:0px; display:none;" id="applicationForm">
						<div style="margin-bottom:50px;">
							<label style="margin:0px;"><b>학번</b></label>
							<input type="text" class="form-control border-top-0 border-left-0 border-right-0 rounded-0"
								   placeholder="학번을 입력하세요." id="userCode" value="<%= stuInfo.stuno %>">
						</div>
						
						<div style="margin-bottom:50px;">
							<label style="margin:0px;"><b>이름</b></label>
							<input type="text" class="form-control border-top-0 border-left-0 border-right-0 rounded-0"
								   placeholder="이름을 입력하세요." id="userName" value="<%= stuInfo.stuname %>">
						</div>
						
						<div style="margin-bottom:40px;">
							<label><b>성별</b></label>
							<br/>
							<input type="radio" class="form-input" name="userGender" id="genderFemale" style="border:1px solid #ffff00; margin-left:10px;" value="여성">
							<label for="genderFemale">여성</label>
							<input type="radio" class="form-input" name="userGender" id="genderMale" style="border:1px solid #ffff00; margin-left:10px;" value="남성">
							<label for="genderMale">남성</label>
						</div>
						
						<div style="margin-bottom:50px;">
							<label style="margin:0px;"><b>생년월일</b></label>
							<br/>
							<%
								const userBirth = stuInfo.birth;
								const nowYear = new Date().getFullYear().toString().substring(2, 4);
							
								let fullBirth = "";
							
								if(parseInt(nowYear) > parseInt(userBirth.substring(0, 2))) {
									fullBirth = "20" + userBirth.substring(0, 2) + "-" + userBirth.substring(2, 4) + "-" + userBirth.substring(4, 6);
								}
								else {
									fullBirth = "19" + userBirth.substring(0, 2) + "-" + userBirth.substring(2, 4) + "-" + userBirth.substring(4, 6);
								}
							%>
							<input type="date" class="form-control border-top-0 border-left-0 border-right-0 rounded-0" id="userBirth"
								   autocomplete="off" tabindex="0" value="<%= fullBirth %>">
						</div>
						
						<div id="phoneForm" style="margin-bottom:50px;">
							<label style="margin:0px;"><b>휴대폰</b></label>
							<input type="phone" class="form-control border-top-0 border-left-0 border-right-0 rounded-0"
								   placeholder="010-XXXX-XXXX" id="userPhone" value="<%= stuInfo.phonenum %>">
						</div>
						
						<div id="emailForm" style="margin-bottom:50px;">
							<label style="margin:0px;"><b>이메일</b></label>
							<input type="email" class="form-control border-top-0 border-left-0 border-right-0 rounded-0"
								   placeholder="email@example.com" id="userEmail" value="<%= stuInfo.email %>">
						</div>
						
						<div style="display:none;" id="consultForm">
							<% for(let i=0; i<consultAsk.length; i++){ %>
							<div class="form-group">
								<div class="form-group form-question">
									<label id="consultAsk<%=i%>"><b><%= unescape(consultAsk[i].ask) %></b></label><br/>
									<input type="hidden" value="<%=consultAsk[i].askno%>" id="consultAskVal<%=i%>"/>
								<% if(consultAsk[i].choicetypename === "Radio"){ %>
									<% for(let j=0; j<consultAsk[i].choices.split('|').length; j++){ %>
									<input type="radio" class="from-input mb-4" name="consultAskAnswer<%=i%>"
										   id="<%= 'consultAnswer'+i+j %>" value="<%= consultAsk[i].choices.split('|')[j] %>">
									<label for="<%= 'consultAnswer'+i+j %>"><%= unescape(consultAsk[i].choices.split('|')[j]) %></label><br/>
									<% } %>
								<% } %>
								<% if(consultAsk[i].choicetypename === "Check"){ %>
									<% for(let j=0; j<consultAsk[i].choices.split('|').length; j++){ %>
									<input type="checkbox" class="from-input mb-4" name="consultAskAnswer<%=i%>"
										   id="<%= 'consultAnswer'+i+j %>" value="<%= consultAsk[i].choices.split('|')[j] %>">
									<label for="<%= 'consultAnswer'+i+j %>"><%= unescape(consultAsk[i].choices.split('|')[j]) %></label><br/>
									<% } %>
								<% } %>
								<% if(consultAsk[i].choicetypename === "Normal"){ %>
									<textarea class="form-control mb-4" placeholder="자유롭게 작성해 주세요." name="consultAskAnswer<%=i%>"
											  id="<%= 'consultAnswer'+i %>" style="resize:none;"></textarea>
								<% } %>
								</div>
							</div>
							<% } %>
						</div>
						
						<div style="display:none;" id="psyTestForm">
							<% for(let i=0; i<testAsk.length; i++){ %>
							<div class="form-group">
								<div class="form-group form-question">
									<label id="mentalAsk<%=i%>"><b><%= unescape(testAsk[i].ask) %></b></label><br/>
									<input type="hidden" value="<%=testAsk[i].askno%>" id="mentalAskVal<%=i%>"/>
								<% if(testAsk[i].choicetypename === "Radio"){ %>
									<% for(let j=0; j<testAsk[i].choices.split('|').length; j++){ %>
									<input type="radio" class="from-input mb-4" name="mentalAskAnswer<%=i%>"
										   id="<%= 'mentalAnswer'+i+j %>" value="<%= testAsk[i].choices.split('|')[j] %>">
									<label for="<%= 'mentalAnswer'+i+j %>"><%= unescape(testAsk[i].choices.split('|')[j]) %></label><br/>
									<% } %>
								<% } %>
								<% if(testAsk[i].choicetypename === "Check"){ %>
									<% for(let j=0; j<testAsk[i].choices.split('|').length; j++){ %>
									<input type="checkbox" class="from-input mb-4" name="mentalAskAnswer<%=i%>"
										   id="<%= 'mentalAnswer'+i+j %>" value="<%= testAsk[i].choices.split('|')[j] %>">
									<label for="<%= 'mentalAnswer'+i+j %>"><%= unescape(testAsk[i].choices.split('|')[j]) %></label><br/>
									<% } %>
								<% } %>
								<% if(testAsk[i].choicetypename === "Normal"){ %>
									<textarea class="form-control mb-4" placeholder="자유롭게 작성해 주세요." name="mentalAskAnswer<%=i%>"
											  id="<%= 'mentalAnswer'+i %>" style="resize:none;"></textarea>
								<% } %>
								</div>
							</div>
							<% } %>

							<div class="form-group" style="margin-top:60px;">
								<label style="margin-bottom:30px;"><b>원하는 심리검사를 선택해주세요.</b><br/>(중복선택 가능)</label><br/>
								<div class="form-group">
									<% for(let i=0; i<psyTestList.length; i++){ %>
									<div class="form-group">
										<input type="checkbox" class="pull-left;" id="<%= 'psyTestType'+i %>"
											   value="<%= psyTestList[i].testno %>" name="psyTestList" style="margin-right:20px;">
										<label for="<%= 'psyTestType'+i %>"><%= psyTestList[i].testname %></label>
										<input type="button" class="btnMentalClass pull-right" id="<%= 'psyTestDes'+i%>"
											   onclick="alert('<%= psyTestList[i].description %>');">
									</div>
									<br/>
									<% } %>
								</div>
							</div>
						</div>

						<div class="form-group text-right" style="margin-top:50px;"> 
							<input type="button" class="btn btn-primary mb-2" id="btnFirstNext" value="다 음">
						</div>
						
					</div>
				</div>
				
				<div class="tab-pane fade" id="reservationTab">
					<div style="margin-bottom:30px; margin-top:10%;">
						<select class="custom-select" id="counselorList" style="width:180px;">
							<option value="">상담 선생님 선택</option>
						</select>
					</div>
					
					<div style="margin-bottom:30px; display:none;" id="divType">
						<label><b>유형</b></label>
						<div class="row formType" id="reservationType">
							<div class="col btnType">
								채팅<br/>상담
								<input type="hidden" class="reservationValue" value="1">
							</div>
							<div class="col btnType">
								화상<br/>상담
								<input type="hidden" class="reservationValue" value="2">
							</div>
							<div class="col btnType">
								전화<br/>상담
								<input type="hidden" class="reservationValue" value="3">
							</div>
							<div class="col btnType">
								대면<br/>상담
								<input type="hidden" class="reservationValue" value="4">
							</div>
						</div>
					</div>
					
					<div style="margin-bottom:30px; display:none;" id="divDate">
						<label><b>날짜</b></label>
						<div class="row formDate" id="possibleDate">
						</div>
					</div>
					
					<div style="margin-bottom:30px; display:none;" id="divTime">
						<label><b>시간</b></label>
						<div class="row formTime" id="possibleTime">
						</div>
						<label>※ 상담시간 : 1회당 50분</label>
					</div>
					
					<div class="form-group text-right" style="margin-top:50px; margin-bottom:0!important; display:none;" id="divSecondNext"> 
						<input type="button" class="btn btn-primary mb-2" id="btnSecondNext" style="margin-top:2px;" value="다 음">
					</div>
				</div>
				
				<div class="tab-pane fade" id="selfcheckTab">
					<div class="row selfchek-title" style="height: 60px;">
						<div class="col align-self-center text-center">
							<label>간단 자가진단</label>
						</div>
					</div>
					<div id="divisionSelfcheck">
					</div>
					
					<div class="form-group text-right" style="margin-top:50px; margin-bottom:0!important;" id="divThirdNext"> 
						<input type="button" class="btn btn-primary mb-2" id="btnThirdNext" style="margin-top:2px;" value="다 음">
					</div>
				</div>
				
				<div class="tab-pane fade" id="privacyTab">
					
					<div class="row">
						<div class="col-title col">
							<input type="checkbox" id="agreebox1" name="agreebox" class="btnClass"><label for="agreebox1" class="text-default"><label class="col-agreetext">(필수)
							</label> 유한누리 이용약관 동의</label>
						</div>
					</div>

					<div class="row">
						<div class="col-text col">
							<div class="form-text form-control overflow-auto">
								<p class="text-danger">
									테스트1
								</p>
								<p>
									Lorem Ipsum is simply dummy text of the printing and typesetting industry.
									Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,
									when an unknown printer took a galley of type and scrambled it to make a type specimen book.

									Lorem Ipsum is simply dummy text of the printing and typesetting industry.
									Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,
									when an unknown printer took a galley of type and scrambled it to make a type specimen book.
								</p>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-title col">
						<input type="checkbox" id="agreebox2" name="agreebox" class="btnClass"><label for="agreebox2" class="text-default"><label class="col-agreetext">
							(필수)</label> 개인정보 수집 및 이용 동의</label>
						</div>
					</div>

					<div class="row">
						<div class="col-text col">
							<div class="form-text form-control overflow-auto">
								<p class="text-danger">
									테스트2
								</p>
								<p>
									Lorem Ipsum is simply dummy text of the printing and typesetting industry.
									Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,
									when an unknown printer took a galley of type and scrambled it to make a type specimen book.

									Lorem Ipsum is simply dummy text of the printing and typesetting industry.
									Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,
									when an unknown printer took a galley of type and scrambled it to make a type specimen book.
								</p>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-title col">
						<input type="checkbox" id="agreebox3" name="agreebox" class="btnClass">
							<label for="agreebox3" class="text-default">유한누리 이용약관, 개인정보 수집 및 이용에 모두 동의합니다.</label>
						</div>
					</div>

					<div class="row">
						<div class="col text-right" style="margin-top:45px;">
							<input type="button" class="btn btn-submit btn-primary mb-2" id="btnComplete" value="확 인">
						</div>
					</div>
					
				</div>
			</div>
		</div>
		<script src="/socket.io/socket.io.js"></script>
		<script>
			const socket = io('/reservation');
			let sendData = {}

			$('#appMental').click(function(e) {
				document.getElementById("applicationForm").style.display = "block";
				document.getElementById("psyTestForm").style.display = "block";
				document.getElementById("consultForm").style.display = "none";
			});

			$('#appConsult').click(function(e) {
				document.getElementById("applicationForm").style.display = "block";
				document.getElementById("consultForm").style.display = "block";
				document.getElementById("psyTestForm").style.display = "none";
			});

			$("#btnFirstNext").click(function(e) {
				if($('#appMental').is(':checked') === true && applicationValidCheck()) {
					let temp = getMentalAnswer();
					
					let selectPsyTestList= []
					$("input[name='psyTestList']:checked").each(function() {
						selectPsyTestList.push($(this).val());
					});

					
					if(temp != undefined && temp != null) {
						sendData = {
                            type: 2,
							stuCode: $('#userCode').val(),
							stuName: $('#userName').val(),
							stuGender: $("input[name='userGender']:checked").val(),
							stuBirth: $('#userBirth').val(),
							stuEmail: $('#userEmail').val(),
							stuAnswer: temp,
							psyTestList: selectPsyTestList.toString()
						}
						$("#btnFirstNext").attr("disabled", true); 
						socket.emit('initPrivacy');
					}
				}
				else if($('#appConsult').is(':checked') === true && applicationValidCheck()) {
					let temp = getConsultAnswer();
					if(temp != undefined && temp != null) {
						sendData = {
                            type: 1,
							stuCode: $('#userCode').val(),
							stuName: $('#userName').val(),
							stuGender: $("input[name='userGender']:checked").val(),
							stuBirth: $('#userBirth').val(),
							stuEmail: $('#userEmail').val(),
							stuAnswer: temp
						}
						$("#btnFirstNext").attr("disabled", true);
						socket.emit('initReservation');
					}
				}
			});

			socket.on('initPrivacy', function() {
				$('input[name=agreebox]').click(function(){
					if($("#agreebox3").is(":checked")){
						if(!$("#agreebox2").is(":checked") || !$("#agreebox1").is(":checked")) {
							$("input:checkbox[id='agreebox3']").prop("checked", false);
						}
					}

					if($("#agreebox1").is(":checked") && $("#agreebox2").is(":checked")) {
						$("input:checkbox[name=agreebox]").each(function() {
							this.checked = true;
						});
						$('#btnComplete').focus();
					}
				});

				$('#agreebox3').click(function(e) {	// 모두 동의 버튼
					if($("input:checkbox[id='agreebox3']").is(":checked") == false) {
						agreebox1.checked = true;
						agreebox2.checked = true;
						$("input:checkbox[id='agreebox3']").prop("checked", true);
						
						$('#btnComplete').focus();
					}
					else{
						agreebox1.checked = false;
						agreebox2.checked = false;
						$("input:checkbox[id='agreebox3']").prop("checked", false);
					}
				});

				$('#btnComplete').click(function(e) {
					if($('#agreebox3').is(':checked') === true) {
						socket.emit('initComplete', sendData);
					}
					else{
						alert("개인정보동의서를 모두 동의해야 신청이 가능합니다.");
						document.getElementById("agreebox3").focus();
					}
				});

				$('#applicationTab').removeClass('show active');
				$('#selfcheckTab').removeClass('show active');

				$('#privacyTab').addClass('show active');
			});

			socket.on('initReservation', function(data) {
				const counselor = data;

				for(let i = 0; i < counselor.length; i++) {
					$('#counselorList').append(`
						<option value="${counselor[i].empid}">${counselor[i].empname} 선생님</option>
					`);
				}

				const tomorrow = new Date(new Date().getTime() + 86400000);
				let cnt = 0;
				let num = 0;

				$('#possibleDate').before(`<br/><label style="font-size:0.8em;">${tomorrow.getMonth()+1}월</label>`);
				
				while(cnt < 10) {
					if(cnt === 5) $('#possibleDate').append(`<div class="w-100"></div>`);
					
					let countDate = new Date((tomorrow.getTime() + (86400000 * num)));
					num = num + 1;
					
					if(countDate.getDay() === 0 || countDate.getDay() === 6) continue;
					else {
						if(countDate.getDate() == 1 && cnt != 0) {
							$('#possibleDate').append(`
								<div class="col btnDate" id="btnDate${countDate.getDate()}">${tomorrow.getMonth()+2 == 13 ? 1 : tomorrow.getMonth()+2}.${countDate.getDate()}</div>
							`);
						}
						else {
							$('#possibleDate').append(`
								<div class="col btnDate" id="btnDate${countDate.getDate()}">${countDate.getDate()}</div>
							`);
						}
						cnt = cnt + 1;
					}
				}

				for(let i=0; i<9; i++) {
					let countTime = i + 9;
					if(countTime === 12) continue;
					else if(countTime === 14) {
						$('#possibleTime').append(`
							<div class="w-100"></div>
							<div class="col btnTime" id="btnTime${countTime}">${countTime}</div>
						`);
					}
					else {
						$('#possibleTime').append(`
							<div class="col btnTime" id="btnTime${countTime}">${countTime}</div>
						`);
					}
				}

				$(".btnType").click(function(e) {
					const typeList = document.getElementsByClassName('btnType');
					for(let i=0; i<typeList.length; i++) {
						if(typeList[i].className.includes("use")) typeList[i].classList.remove("use");
						typeList[i].style.backgroundColor = "#fff";
                        typeList[i].style.color = "#212529";
					}
                    $(this).addClass('use');
					$(this).css("background-color", '#0275d8');
					$(this).css("color", '#fff');

					sendData.reservationCode = $(this)[0].getElementsByClassName('reservationValue')[0].value;
				});

				$(".btnDate").click(function(e) {
					const dateList = document.getElementsByClassName('btnDate');
					if($(this).hasClass('possible')) {
						for(let i=0; i<dateList.length; i++) {
							dateList[i].style.backgroundColor = "#fff";
							if(dateList[i].className.includes("possible")) dateList[i].style.color = "#007BFF";
							else dateList[i].style.color = "#212529";
						}
						$(this).css("background-color", '#0275d8');
						$(this).css("color", '#fff');

						$('#divTime').css('display', 'block');
						$('#divSecondNext').css('display', 'none');

						socket.emit("selectDateTime", {
							date: $(this).val(),
							empid: $('#counselorList').val()
						});

						sendData.date = $(this).val();
					}
				});

				$(".btnTime").click(function(e) {
					const dateList = document.getElementsByClassName('btnTime');
					if($(this).hasClass('possible')) {
						for(let i=0; i<dateList.length; i++) {
							dateList[i].style.backgroundColor = "#fff";
							if(dateList[i].className.includes("possible")) {
								dateList[i].style.color = "#007BFF";
							}
							else dateList[i].style.color = "#212529";
						}
						$(this).css("background-color", '#0275d8');
						$(this).css("color", '#fff');
						$('#divSecondNext').css('display', 'block');

						sendData.time = $(this)[0].innerText;
                        $("#btnSecondNext").focus();
					}
				});

				$("#counselorList").change(function() {
					const empid = $("#counselorList").val();
					if(empid === "") {
						const dateList = document.getElementsByClassName('btnDate');
						for(let i=0; i<dateList.length; i++) {
							dateList[i].classList.remove("possible");
							dateList[i].style.backgroundColor = "#fff";
							dateList[i].style.color = "#212529";
						}

						const timeList = document.getElementsByClassName('btnTime');
						for(let i=0; i<timeList.length; i++) {
							timeList[i].classList.remove("possible");
							timeList[i].style.backgroundColor = "#fff";
							timeList[i].style.color = "#212529";
						}

						$('#divType').css('display', 'none');
						$('#divDate').css('display', 'none');
						$('#divTime').css('display', 'none');

						$('#divSecondNext').css('display', 'none');
					}
					else {
						socket.emit('selectCounselor', empid);
                        
                        const typeList = document.getElementsByClassName('btnType');
                        for(let i=0; i<typeList.length; i++) {
                            if(typeList[i].className.includes("use")) typeList[i].classList.remove("use");
                            typeList[i].style.backgroundColor = "#fff";
                            typeList[i].style.color = "#212529";
                        }
                        
                        const dateList = document.getElementsByClassName('btnDate');
						for(let i=0; i<dateList.length; i++) {
							dateList[i].classList.remove("possible");
							dateList[i].style.backgroundColor = "#fff";
							dateList[i].style.color = "#212529";
                            dateList[i].style.fontWeight = "normal";
						}

						const timeList = document.getElementsByClassName('btnTime');
						for(let i=0; i<timeList.length; i++) {
							timeList[i].classList.remove("possible");
							timeList[i].style.backgroundColor = "#fff";
							timeList[i].style.color = "#212529";
						}

						$('#divType').css('display', 'block');
						$('#divDate').css('display', 'block');
						$('#divTime').css('display', 'none');

						$('#divSecondNext').css('display', 'none');
					}
					sendData.empid = empid;
				});

				$("#btnSecondNext").click(function(e) {
                    let count = 0;
                    
                    const typeList = document.getElementsByClassName('btnType');
					for(let i=0; i<typeList.length; i++) {
						if(typeList[i].className.includes("use")) count++;
					}
                    
                    if(count === 0) {
                        alert("상담 유형을 선택해 주세요.");
                        document.getElementsByClassName('btnType')[0].focus();
                    }
                    else {
                        const empid = $("#counselorList").val();
                        socket.emit('initSelfcheck', empid);
                    }
				});

				$('#applicationTab').removeClass('show active');
				$('#reservationTab').addClass('show active');
			});

			socket.on('selectCounselor', function(date) {
				if(date.length > 0) {
					for(let i=0; i<date.length; i++) {
						const tempDate = new Date(date[i].possible).getDate();

						$('#btnDate'+tempDate).css("background-color", '#fff');
						$('#btnDate'+tempDate).css("color", '#0275d8');
						$('#btnDate'+tempDate).addClass('possible');

						$('#btnDate'+tempDate).css("font-weight", "bold");

						$('#btnDate'+tempDate).val(date[i].possible);
					}
				}
				else {
					const dateList = document.getElementsByClassName('btnDate');

					for(let i=0; i<dateList.length; i++) {
						dateList[i].classList.remove("possible");
						dateList[i].style.backgroundColor = "#fff";
						dateList[i].style.color = "#212529";
					}
				}
			});

			socket.on('returnTime', function(list) {
				const dateList = document.getElementsByClassName('btnTime');

				for(let i=0; i<dateList.length; i++) {
					dateList[i].classList.remove("possible");
					dateList[i].style.backgroundColor = "#fff";
					dateList[i].style.color = "#212529";
				}

				for(let i=0; i<list.length; i++) {
					if(list[i] === 12) continue;
					else {
						$('#btnTime'+list[i]).css("color", '#0275d8');
						$('#btnTime'+list[i]).addClass('possible');
						$('#btnTime'+list[i]).css("font-weight", "bold");
					}
				}
			});

			socket.on('initSelfcheck', function(list) {
				for(let i=0; i<list.length; i++) {
					$('#divisionSelfcheck').append(`
						<div class="row selfcheck-subject">
							<div class="col align-self-center text-center">
								<label name="selfcheck"><b>${unescape(list[i].checkname)}</b></label>
								<input type="hidden" value="${list[i].checkno}" id="selfcheckCode${i}"/>
							</div>
						</div>
						<div class="row" style="margin-bottom:70px;">
							<label style="font-size:130%;color:#494949;margin-left:3%;padding-top:2%;">나쁨</label>
							<div id="radios">
							  <label class="radio-border" for="${list[i].checkno}_1"></label>
							  <input class="selfcheck-radio radio1" id="${list[i].checkno}_1" name="selfcheck${i}" type="radio" value="1"/>
							  <label class="radio-border" for="${list[i].checkno}_2"></label>
							  <input class="selfcheck-radio radio2" id="${list[i].checkno}_2" name="selfcheck${i}" type="radio" value="2"/>
							  <label class="radio-border" for="${list[i].checkno}_3"></label>
							  <input class="selfcheck-radio radio3" id="${list[i].checkno}_3" name="selfcheck${i}" type="radio" value="3"/>
							  <label class="radio-border" for="${list[i].checkno}_4"></label>
							  <input class="selfcheck-radio radio4" id="${list[i].checkno}_4" name="selfcheck${i}" type="radio" value="4"/>
							  <label class="radio-border" for="${list[i].checkno}_5"></label>
							  <input class="selfcheck-radio radio5" id="${list[i].checkno}_5" name="selfcheck${i}" type="radio" value="5"/>
							  <span id="slider"></span>
							</div>
						   <label style="font-size:130%;color:#494949;margin-right:3%;padding-top:2%;">좋음</label>
						</div>
					`);
					$("input:radio[name='selfcheck"+i+"']:radio[value='3']").prop('checked', true);
				}

				$("#btnThirdNext").click(function(e) {
					const elmSelfcheck = document.getElementsByName('selfcheck');
					let selfcheckCode = [];
					let selfcheckNum = [];

					for(let i=0; i < elmSelfcheck.length; i++) {
						selfcheckCode.push($('#selfcheckCode'+i).val());
						selfcheckNum.push($('input[name=selfcheck'+i+']:checked').val());
					}
					sendData.selfcheckCode = selfcheckCode.toString();
					sendData.selfcheckNum = selfcheckNum.toString();

					socket.emit('initPrivacy');
				});

				$('#reservationTab').removeClass('show active');
				$('#selfcheckTab').addClass('show active');
			});

			socket.on('initComplete', function() {
				alert("예약이 완료되었습니다, 감사합니다.");
				window.flutter_inappwebview
					.callHandler('PageHandler', 'replaceMain');  // Flutter Inappwebview 의 ReservationHandler를 호출  
			});

			function applicationValidCheck() {
				if($('#userCode').val() === ""){
					document.getElementById("userCode").focus();
					alert("학번을 입력하세요.");
					return false;
				}else{
					if($('#userName').val() === ""){
						document.getElementById("userName").focus();
						alert("이름을 입력하세요.");
						return false;
					}else{
						if($('input:radio[name=userGender]').is(':checked') === false){
							document.getElementById("genderFemale").focus();
							alert("성별을 선택하세요.");
							return false;
						}else{
							if($('#userEmail').val() === ""){
								document.getElementById("userEmail").focus();
								alert("이메일을 작성하세요.");
								return false;
							}else if(CheckEmail(document.getElementById("userEmail").value) === false){
								document.getElementById("userEmail").focus();
								alert("이메일의 형식을 확인하세요.");
								return false;
							}else{
								if($('#appMental').is(':checked') === true && $('input:checkbox[name=psyTestList]').is(':checked') == false){
									alert("심리검사 유형을 1개 이상 선택하세요.");
									document.getElementById("psyTestType0").focus();
									return false;
								}else{
									return true;
								}
							}
						}
					}
				}
			} // 간단 신청서 부분 유효성 검사

			function CheckEmail(str){                                                 
				const reg_email = /^([0-9a-zA-Z_\.-]+)@([0-9a-zA-Z_-]+)(\.[0-9a-zA-Z_-]+){1,2}$/;
				if(!reg_email.test(str)) return false;
				else return true;                        
			}  // 간단 신청서 부분 이메일 유효성 검사

			function getMentalAnswer() {
				let dynamic = [];

				for(let i=0; i < <%= testAsk.length %>; i++) {
					let temp = {}

					let what_type = document.getElementsByName("mentalAskAnswer"+i)[0].type;
					if(what_type === 'radio') {
						let checkAnswer = $('input[name=mentalAskAnswer'+i+']:checked').val();
						if(checkAnswer != undefined) temp.answer = $('input[name=mentalAskAnswer'+i+']:checked').val();
						else {
							alert('답변하지 않은 질문이 있습니다.');
							$('input[name=mentalAskAnswer'+i+']').focus();
							dynamic.length = 0;
							return null;
						}
					}
					else if(what_type === 'checkbox') {
						let checkAnswer = [];
						$('input:checkbox[name=mentalAskAnswer'+i+']:checked').each(function() {
							checkAnswer.push($(this).val());
						});

						if(checkAnswer.length !== 0) temp.answer = checkAnswer.toString();
						else {
							alert('답변하지 않은 질문이 있습니다.');
							$('input:checkbox[name=mentalAskAnswer'+i+']').focus();
							dynamic.length = 0;
							return null;
						}
					}
					else if(what_type === 'textarea') {
						let txt = $('[name=mentalAskAnswer'+i+']').val();
						if(txt !== "") temp.answer = $('[name=mentalAskAnswer'+i+']').val();
						else {
							alert('답변하지 않은 질문이 있습니다.');
							$('[name=mentalAskAnswer'+i+']').focus();
							dynamic.length = 0;
							return null;
						}
					}
					temp.question = $('#mentalAskVal'+i).val();
					dynamic.push(temp);
				}
				return dynamic;
			}

			function getConsultAnswer() {
				let dynamic = [];

				for(let i=0; i < <%= consultAsk.length %>; i++) {
					let temp = {}

					let what_type = document.getElementsByName("consultAskAnswer"+i)[0].type;
					if(what_type === 'radio') {
						let checkAnswer = $('input[name=consultAskAnswer'+i+']:checked').val();
						if(checkAnswer != undefined) temp.answer = $('input[name=consultAskAnswer'+i+']:checked').val();
						else {
							alert('답변하지 않은 질문이 있습니다.');
							$('input[name=consultAskAnswer'+i+']').focus();
							dynamic.length = 0;
							return null;
						}
					}
					else if(what_type === 'checkbox') {
						let checkAnswer = [];
						$('input:checkbox[name=consultAskAnswer'+i+']:checked').each(function() {
							checkAnswer.push($(this).val());
						});

						if(checkAnswer.length !== 0) temp.answer = checkAnswer.toString();
						else {
							alert('답변하지 않은 질문이 있습니다.');
							$('input:checkbox[name=consultAskAnswer'+i+']').focus();
							dynamic.length = 0;
							return null;
						}
					}
					else if(what_type === 'textarea') {
						let txt = $('[name=consultAskAnswer'+i+']').val();
						if(txt !== "") temp.answer = $('[name=consultAskAnswer'+i+']').val();
						else {
							alert('답변하지 않은 질문이 있습니다.');
							$('[name=consultAskAnswer'+i+']').focus();
							dynamic.length = 0;
							return null;
						}
					}
					temp.question = $('#consultAskVal'+i).val();
					dynamic.push(temp);
				}
				return dynamic;
			}
		</script>
	</body>
</html>