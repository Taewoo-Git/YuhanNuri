<!DOCTYPE html>
<html>
	<head>
		<title>상담 예약</title>
		<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
			  integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
			  crossorigin="anonymous">
		
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"
				integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
				crossorigin="anonymous">
		</script>
		
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" 
				integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" 
				crossorigin="anonymous">
		</script>

		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
				integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
				crossorigin="anonymous">
		</script>
        <style>
			.top-bar{
				padding: 0;
				background-color: #006961;
			}
			.top-backward{
                font-size: 130%;
                color: white;
            }
			.top-title{
				position: absolute;
				top: 2.5%;
				left: 50%;
				transform: translateX(-50%);
				font-weight: bold;
				font-size: 150%;
				color: white;
			}
            .col-title{
                text-align: center;
                font-weight: bold;
                margin-top: 0;
            }
            .col-type{
                padding: 0 1%;
                width: 100%;
				margin-bottom: 15%;
            }
            .btn-type{
                padding: 20% 0;
                height: 100%;
                width: 100%;
                font-weight: bold;
            }
            .col-date{
                padding: 0 1%;
                width: 100%;
                text-align: center;
				margin-bottom: 13%;
            }
            .btn-date{
                height: 70%;
                width: 100%;
                padding: 30% 0;
                font-weight: bold;
            }
            .col-time{
                padding: 1%;
            }
            .btn-time{
                width: 100%;
                font-weight: bold;
            }
            .col-submit{
                position: absolute;
                bottom: 0;
                padding: 0;
            }
            .btn-submit{
                height: 130%;
                width: 100%;
                padding: 3%;
                font-weight: bold;
                font-size: 115%;
            }
        </style>
	</head>
	<body>
		<div class="top-bar shadow p-3 mb-5 rounded">
            <button class="btn" id="btn-back"><i class="fa fa-arrow-left top-backward" aria-hidden="true"></i></button>
			<label class="top-title">상담 예약</label>
        </div>
		
		<div class="container-fluid">
			
			<div class="row">
				<div class="col-title col">
					<label class="text-primary text-counselor">상담사 선생님 선택</label>
				</div>
			</div>
		
			<div class="row">
				<div class="dropdown">
					<button class="btn btn-secondary dropdown-toggle dropdown-counselor-title" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">상담사 선생님</button>
					<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
						<% for(let i = 0; i < counselorNameList.length; i++){ %>
							<button class="dropdown-counselor dropdown-item" value="<%= counselorNameList[i][0] %>"><%= counselorNameList[i][1] %></button>
						<% } %>
						
					</div>
				</div>
			</div>
            <div class="row">
                <div class="col-title col">
                    <label class="text-primary">상담 유형 선택</label>
                </div>
            </div>
            
            <div class="row">
                <div class="col-type col">
                    <button class="btn-type btn btn-outline-primary" value="1">대면<br/>상담</button>
                </div>
                <div class="col-type col">
                    <button class="btn-type btn btn-outline-primary" value="2">화상<br/>상담</button>
                </div>
                <div class="col-type col">
                    <button class="btn-type btn btn-outline-primary" value="3">채팅<br/>상담</button>
                </div>
                <div class="col-type col">
                    <button class="btn-type btn btn-outline-primary" value="4">대면<br/>심리검사</button>
                </div>
                <div class="col-type col">
                    <button class="btn-type btn btn-outline-primary" value="5">온라인<br/>심리검사</button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-title col">
                    <label class="text-danger">날짜 선택</label>
                </div>
            </div>
            
            <div class="row">
                <div class="col-date col">
                    <button class="btn-date btn btn-outline-danger"></button>
                    <label class="text-danger"></label>
                </div>
                <div class="col-date col">
                    <button class="btn-date btn btn-outline-danger"></button>
                    <label class="text-danger"></label>
                </div>
                <div class="col-date col">
                    <button class="btn-date btn btn-outline-danger"></button>
                    <label class="text-danger"></label>
                </div>
                <div class="col-date col">
                    <button class="btn-date btn btn-outline-danger"></button>
                    <label class="text-danger"></label>
                </div>
                <div class="col-date col">
                    <button class="btn-date btn btn-outline-danger"></button>
                    <label class="text-danger"></label>
                </div>
                <div class="col-date col">
                    <button class="btn-date btn btn-outline-danger"></button>
                    <label class="text-danger"></label>
                </div>
                <div class="col-date col">
                    <button class="btn-date btn btn-outline-danger"></button>
                    <label class="text-danger"></label>
                </div>
            </div>
            
            <div class="row">
                <div class="col-title col">
                    <label class="text-success">시간 선택</label>
                </div>
            </div>
            
            <div class="row">
                <div class="col-time col">
                    <button class="btn-time btn btn-outline-dark" value="9" disabled>09시</button>
                </div>
                <div class="col-time col">
                    <button class="btn-time btn btn-outline-dark" value="10" disabled>10시</button>
                </div>
                <div class="col-time col">
                    <button class="btn-time btn btn-outline-dark" value="11" disabled>11시</button>
                </div>
                <div class="col-time col">
                    <button class="btn-time btn btn-outline-dark" value="13" disabled>13시</button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-time col">
                    <button class="btn-time btn btn-outline-dark" value="14" disabled>14시</button>
                </div>
                <div class="col-time col">
                    <button class="btn-time btn btn-outline-dark" value="15" disabled>15시</button>
                </div>
                <div class="col-time col">
                    <button class="btn-time btn btn-outline-dark" value="16" disabled>16시</button>
                </div>
                <div class="col-time col">
                    <button class="btn-time btn btn-outline-dark" value="17" disabled>17시</button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-submit col">
                    <form method="POST">
						<input type="hidden" id="reserv_counselorId_id" name="reserv_counselorId" value="">
                        <input type="hidden" id="reserv_type_id" name="reserv_type" value="">
                        <input type="hidden" id="reserv_date_id" name="reserv_date" value="">
                        <input type="hidden" id="reserv_time_id" name="reserv_time" value="">
                        <input type="submit" class="btn-submit btn btn-secondary" style="border-radius:0;" id="reserv_submit" value="선택 완료" disabled>
                    </form>
                </div>
            </div>
        </div>
        
        <script>
            $(function() {
                var current_month = new Date().getMonth()+1;
                var week = ['일', '월', '화', '수', '목', '금', '토'];
                
                for(let i = 0; i < $('.col-date').length; i++) {
                    var selecting_date = new Date();
                    selecting_date.setDate(new Date().getDate()+i);
                    
                    var var_year = selecting_date.getFullYear();
                    let var_month = selecting_date.getMonth()+1;
                    let var_date = selecting_date.getDate();
                    let var_day = selecting_date.getDay()%7;
                    
                    let elm_date = $('.col-date').eq(i);
                    
                    if(current_month === var_month) {
                        elm_date.children('button').text(var_date);
                        elm_date.children('label').text(week[var_day]);
                    }
                    else {
                        elm_date.children('button').text(var_month+"."+var_date);
                        elm_date.children('label').text(week[var_day]);
                    }
                    
                    if(var_day === 6 || var_day === 0) {
                        elm_date.children('button').attr('disabled', true);
                        
                        elm_date.children('button').removeClass('btn-outline-danger');
                        elm_date.children('button').addClass('btn-outline-dark');
                        
                        elm_date.children('label').removeClass('text-danger');
                        elm_date.children('label').addClass('text-dark');
                    }
                    else {
                        if (var_date < 10) var_date = "0" + var_date;
                        if (var_month < 10) var_month = "0" + var_month;
						
                        let var_value = var_year + "-" + var_month + "-" + var_date;
                        elm_date.children('button').val(var_value);
                    }
                }
            });
            $('.dropdown-counselor').click(function() {
				let selectedCounselorName = $(this).text();
				let selectedCounselorId = $(this).val();
				
				$('.dropdown-counselor-title').text(selectedCounselorName);
				$('#reserv_counselorId_id').val(selectedCounselorId);
				
			});
            $('.btn-type').click(function() {
                $(this).removeClass('btn-outline-primary');
                $(this).addClass('btn-primary');
                
                $('#reserv_type_id').val($(this).val());
            })
            
            $('.btn-date').click(function() {
                let seleted_btn = $('.btn-danger');
                seleted_btn.removeClass('btn-danger');
                seleted_btn.addClass('btn-outline-danger');
                
                $(this).removeClass('btn-outline-danger');
                $(this).addClass('btn-danger');
                
                $('#reserv_date_id').val($(this).val());
                
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "./getPossibleTime",
                    async: true,
                    data: {"ajax_counselorId" : $('#reserv_counselorId_id').val(), "ajax_date" : $('#reserv_date_id').val()},

                    success: function (data) {
						console.info(data);
                        for(let j=0; j<8; j++) {
                            $('.btn-time').eq(j).attr('disabled', true);
							
							
                            $('.btn-time').eq(j).addClass('btn-outline-dark');
							/*
							$('.btn-time').eq(j).removeClass('btn-success');
                            $('.btn-time').eq(j).addClass('btn-outline-success');
							
							$('#reserv_time_id').val("");
                			*/
							
							// $('#reserv_submit').attr('disabled', true);
                        }
						
						/*
                        for(var i=0; i<data.rtntime.length; i++) {
                            if(data.rtntime[i].CNT === 2){
								let getTime = data.rtntime[i].starttime;		
								
								if(getTime < 12) getTime = getTime - 9;
								else getTime = getTime - 10;
								
                                $('.btn-time').eq(getTime).attr('disabled', true);
								
                                $('.btn-time').eq(getTime).removeClass('btn-outline-success');
                                $('.btn-time').eq(getTime).addClass('btn-outline-dark');
                            }
                        }
						*/
						
						for(let i = 0; i < data.rtntime.length; i++){
							let getTime = data.rtntime[i].starttime;
							
							if(getTime < 12) getTime = getTime - 9;
							else getTime = getTime - 10;
							
							$('.btn-time').eq(getTime).removeClass('btn-outline-dark');
							$('.btn-time').eq(getTime).addClass('btn-outline-success');
							$('.btn-time').eq(getTime).attr('disabled', false);
						}
					
                    }
                });
            });
            
            $('.btn-time').click(function() {
				let seleted_btn = $('.btn-success');
                seleted_btn.removeClass('btn-success');
                seleted_btn.addClass('btn-outline-success');
				
                $(this).removeClass('btn-outline-success');
                $(this).addClass('btn-success');
                
                $('#reserv_time_id').val($(this).val());
                
				$('#reserv_submit').attr('disabled', false);
            });
			
			$("#btn-back").click(function(){
				window.history.back();
			});
        </script>
	</body>
</html>